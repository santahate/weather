# –°–∫—Ä–∏–ø—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã METAR/TAF ‚Äì –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç Python‚Äë—Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∞–≤–∏–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–≤–æ–¥–∫–∏ **METAR** –∏ –ø—Ä–æ–≥–Ω–æ–∑—ã **TAF** –¥–ª—è –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –∞—ç—Ä–æ–ø–æ—Ä—Ç–∞,
–¥–µ–∫–æ–¥–∏—Ä—É–µ—Ç –∏—Ö, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ SQLite –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç—á—ë—Ç —Å –≥—Ä–∞—Ñ–∏–∫–æ–º –¥–∞–≤–ª–µ–Ω–∏—è –≤ Telegram‚Äë—á–∞—Ç. –ù–∏–∂–µ –æ–ø–∏—Å–∞–Ω –ø–æ–ª–Ω—ã–π
–∞–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã.

---

## 1. –í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä     | –û–ø–∏—Å–∞–Ω–∏–µ                                      |
|--------------|-----------------------------------------------|
| `--airport`  | ICAO‚Äë–∫–æ–¥ –∞—ç—Ä–æ–ø–æ—Ä—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä `UUEE`).         |
| `--timezone` | –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`UTC+2`, ‚Ä¶).       |
| `--token`    | –¢–æ–∫–µ–Ω Telegram‚Äë–±–æ—Ç–∞ (`123456:ABC‚Äë‚Ä¶`).         |
| `--chat`     | ID Telegram‚Äë—á–∞—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä `-1001234567890`). |

–í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —Å–∫—Ä–∏–ø—Ç—É –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ cron).

---

## 2. –ü–æ–ª—É—á–µ–Ω–∏–µ METAR/TAF

–°–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç HTTP GET:

```
https://aviationweather.gov/api/data/metar?ids={ICAO}&taf=true
```

API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **—Å—ã—Ä—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ** —Å—Ç—Ä–æ–∫–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```
METAR: UUEE 031830Z 26011KT CAVOK 30/14 Q1015
TAF:   UUEE 031700Z 0318/0424 25010KT CAVOK TX31/0412Z TN18/0403Z ...
```

–°–∫—Ä–∏–ø—Ç –æ—Ç–¥–µ–ª—è–µ—Ç METAR –∏ TAF –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º/—Ä–∞–∑—Ä—ã–≤—É —Å—Ç—Ä–æ–∫ –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç –∏—Ö –≤ –ø–∞—Ä—Å–µ—Ä.

---

## 3. –ü–∞—Ä—Å–∏–Ω–≥ METAR –∏ TAF

–î–ª—è —Ä–∞—Å–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:

* **python‚Äëmetar**
* **pytaf** / **metar‚Äëtaf‚Äëparser**

–°–∫—Ä–∏–ø—Ç –∏–∑–≤–ª–µ–∫–∞–µ—Ç:

* –≤—Ä–µ–º—è –Ω–∞–±–ª—é–¥–µ–Ω–∏—è (`031830Z` ‚Üí `YYYY‚ÄëMM‚ÄëDD   18:30 UTC`);
* –≤–µ—Ç–µ—Ä (`26011KT` ‚Üí 260¬∞, 11 —É–∑–ª);
* –≤–∏–¥–∏–º–æ—Å—Ç—å/–æ–±–ª–∞—á–Ω–æ—Å—Ç—å (`CAVOK`, `FEW010`, ‚Ä¶);
* —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞/—Ç–æ—á–∫–∞ —Ä–æ—Å—ã (`30/14`);
* –¥–∞–≤–ª–µ–Ω–∏–µ (`Q1015`   ‚Üí 1015 –≥–ü–∞ –∏–ª–∏ `A2992` ‚Üí 29.92 inHg);
* —Ç–µ–∫—É—â–∏–µ —è–≤–ª–µ–Ω–∏—è (`RA`, `TS`, `FG`, ‚Ä¶);
* –∏–∑ TAF: –≤—Ä–µ–º—è –≤—ã–ø—É—Å–∫–∞, –ø–µ—Ä–∏–æ–¥—ã `FM`, `TEMPO`, `PROB`, —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã `TX`/`TN`.

---

## 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏

–í SQLite —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞ `weather` —Å –ø–æ–ª—è–º–∏:

```
icao TEXT,
metar_text TEXT,
metar_time DATETIME,
taf_text TEXT,
taf_issue_time DATETIME,
created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
UNIQUE (icao, metar_time, taf_issue_time)
```

–ï—Å–ª–∏ –∑–∞–ø–∏—Å—å —Å —Ç–æ–π –∂–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–µ–π `icao + metar_time + taf_issue_time` —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Å–∫—Ä–∏–ø—Ç –ø—Ä–µ–∫—Ä–∞—â–∞–µ—Ç —Ä–∞–±–æ—Ç—É (–Ω–∏–∫–∞–∫–∏—Ö
—Å–æ–æ–±—â–µ–Ω–∏–π –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è).

---

## 5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –æ—á–∏—Å—Ç–∫–∞

* –ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –≤—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É.
* –ü–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º —É–¥–∞–ª—è—é—Ç—Å—è –∑–∞–ø–∏—Å–∏ —Å `created_at < NOW() - 2   –¥–Ω—è`, —á—Ç–æ–±—ã –±–∞–∑–∞ –Ω–µ —Ä–∞–∑—Ä–∞—Å—Ç–∞–ª–∞—Å—å.

---

## 6. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –æ—Ç—á—ë—Ç–∞

1. –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤—Å–µ –≤—Ä–µ–º–µ–Ω–∞ –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–æ—è—Å (`zoneinfo` / `pytz`).
2. –°–æ—Å—Ç–∞–≤–∏—Ç—å –±–ª–æ–∫ **–¢–µ–∫—É—â–∞—è –ø–æ–≥–æ–¥–∞ (METAR)**: —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, –≤–µ—Ç–µ—Ä, –≤–∏–¥–∏–º–æ—Å—Ç—å, –æ–±–ª–∞—á–Ω–æ—Å—Ç—å, –¥–∞–≤–ª–µ–Ω–∏–µ.
3. –°–æ—Å—Ç–∞–≤–∏—Ç—å –±–ª–æ–∫ **–ü—Ä–æ–≥–Ω–æ–∑ (TAF)**: –∫–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–µ —á–∞—Å—ã.
4. –í—ã—è–≤–∏—Ç—å –æ–ø–∞—Å–Ω—ã–µ —è–≤–ª–µ–Ω–∏—è –∏ –¥–æ–±–∞–≤–∏—Ç—å —ç–º–æ–¥–∑–∏‚Äë–∞–ª–µ—Ä—Ç—ã:

| –£—Å–ª–æ–≤–∏–µ                 | –ü—Ä–æ–≤–µ—Ä–∫–∞                    | –≠–º–æ–¥–∑–∏ |
|-------------------------|-----------------------------|--------|
| –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ >   30    ¬∞C   | `temp > 30`                 | üî•     |
| –î–æ–∂–¥—å/–ª–∏–≤–µ–Ω—å            | `RA`, `SHRA`                | ‚òî      |
| –ì—Ä–æ–∑–∞                   | `TS`                        | ‚õàÔ∏è     |
| –ì—Ä–∞–¥                    | `GR`, `GS`                  | üå®Ô∏è    |
| –°–∏–ª—å–Ω—ã–π –≤–µ—Ç–µ—Ä   ‚â•15    –º/—Å | `wind_gust` –∏–ª–∏ `speed`     | üí®     |
| –¢—É–º–∞–Ω/–Ω–∏–∑–∫–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å  | `FG` –∏–ª–∏ vis   <   1000   –º | üå´Ô∏è    |

–ü—Ä–∏–º–µ—Ä —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞:

```
UUEE ‚Ä¢ 15:30    MSK
–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ +30    ¬∞C, —Ç–æ—á–∫–∞ —Ä–æ—Å—ã +14    ¬∞C. –í–µ—Ç–µ—Ä 260¬∞   11    —É–∑–ª. CAVOK. –î–∞–≤–ª–µ–Ω–∏–µ 1015    –≥–ü–∞.

TAF: –¥–æ 21:00 CAVOK; c   21:00 –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–æ–∂–¥—å, –≥—Ä–æ–∑–∞.

üî• –°–∏–ª—å–Ω–∞—è –∂–∞—Ä–∞ ‚Ä¢ ‚õàÔ∏è –í–æ–∑–º–æ–∂–Ω–∞ –≥—Ä–æ–∑–∞
```

---

## 7. –ì—Ä–∞—Ñ–∏–∫ –¥–∞–≤–ª–µ–Ω–∏—è (12    —á)

* –ò–∑ –±–∞–∑—ã –≤—ã–±—Ä–∞—Ç—å `(metar_time, pressure)` –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 12 —á–∞—Å–æ–≤.
* –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫ `matplotlib`:
    * X ‚Äì –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è, Y ‚Äì –¥–∞–≤–ª–µ–Ω–∏–µ (–≥–ü–∞).
    * –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ `pressure_last12h.png`.

---

## 8. –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram

```python
# —Ç–µ–∫—Å—Ç
requests.get(
    f"https://api.telegram.org/bot{TOKEN}/sendMessage",
    params={"chat_id": CHAT_ID, "text": report}
)

# –≥—Ä–∞—Ñ–∏–∫
with open("pressure_last12h.png", "rb") as img:
    requests.post(
        f"https://api.telegram.org/bot{TOKEN}/sendPhoto",
        params={"chat_id": CHAT_ID},
        files={"photo": img}
    )
```

–°–Ω–∞—á–∞–ª–∞ —Ç–µ–∫—Å—Ç, –∑–∞—Ç–µ–º —Ñ–æ—Ç–æ (–∏–ª–∏ –æ–¥–Ω–æ `sendPhoto` —Å `caption`, –µ—Å–ª–∏ —Ç–µ–∫—Å—Ç ‚â§1024 —Å–∏–º–≤.).

---

## 9. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–í—Å–µ –∫–ª—é—á–µ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –æ–±–µ—Ä–Ω—É—Ç—å –≤ `try/except`. –ü—Ä–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–∏:

```python
err = traceback.format_exc()
requests.get(
    f"https://api.telegram.org/bot{TOKEN}/sendMessage",
    params={"chat_id": CHAT_ID, "text": f'‚ùó –û—à–∏–±–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞:
            {err}'}
)
```

---

## 10. –ó–∞–ø—É—Å–∫ –∏–∑ cron

–ü—Ä–∏–º–µ—Ä crontab (–∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç):

```
*/10 * * * * /usr/bin/python3 /home/user/metar_bot.py   --airport UUEE --timezone Europe/Moscow   --token 123456:ABC... --chat -1001234567890
```

–°–∫—Ä–∏–ø—Ç –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –æ–±–Ω–æ–≤–∏–ª–∏—Å—å, –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç –æ—Ç—á—ë—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–æ–≤–æ–º METAR/TAF –∏–ª–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ.
